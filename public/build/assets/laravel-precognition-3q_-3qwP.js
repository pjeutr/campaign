import{a as k,i as M,b as z,m as ee}from"./axios-DZWJTO8Q.js";import{m as B,d as te,s as re,g as x,i as ne,o as H}from"./lodash-es-BeZXkzNc.js";let C=k.create(),G=(e,t)=>`${e.method}:${e.baseURL??t.defaults.baseURL??""}${e.url}`,_=e=>e.status===204&&e.headers["precognition-success"]==="true";const w={},v={get:(e,t={},s={})=>P(S("get",e,t,s)),post:(e,t={},s={})=>P(S("post",e,t,s)),patch:(e,t={},s={})=>P(S("patch",e,t,s)),put:(e,t={},s={})=>P(S("put",e,t,s)),delete:(e,t={},s={})=>P(S("delete",e,t,s)),use(e){return C=e,v},axios(){return C},fingerprintRequestsUsing(e){return G=e===null?()=>null:e,v},determineSuccessUsing(e){return _=e,v}},S=(e,t,s,a)=>({url:t,method:e,...a,...["get","delete"].includes(e)?{params:B({},s,a==null?void 0:a.params)}:{data:B({},s,a==null?void 0:a.data)}}),P=(e={})=>{const t=[se,ie,ae].reduce((s,a)=>a(s),e);return(t.onBefore??(()=>!0))()===!1?Promise.resolve(null):((t.onStart??(()=>null))(),C.request(t).then(async s=>{t.precognitive&&N(s);const a=s.status;let l=s;return t.precognitive&&t.onPrecognitionSuccess&&_(l)&&(l=await Promise.resolve(t.onPrecognitionSuccess(l)??l)),t.onSuccess&&oe(a)&&(l=await Promise.resolve(t.onSuccess(l)??l)),($(t,a)??(d=>d))(l)??l},s=>le(s)?Promise.reject(s):(t.precognitive&&N(s.response),($(t,s.response.status)??((l,E)=>Promise.reject(E)))(s.response,s))).finally(t.onFinish??(()=>null)))},se=e=>{const t=e.only??e.validate;return{...e,timeout:e.timeout??C.defaults.timeout??3e4,precognitive:e.precognitive!==!1,fingerprint:typeof e.fingerprint>"u"?G(e,C):e.fingerprint,headers:{...e.headers,"Content-Type":ue(e),...e.precognitive!==!1?{Precognition:!0}:{},...t?{"Precognition-Validate-Only":Array.from(t).join()}:{}}}},oe=e=>e>=200&&e<300,ie=e=>{var t;return typeof e.fingerprint!="string"||((t=w[e.fingerprint])==null||t.abort(),delete w[e.fingerprint]),e},ae=e=>typeof e.fingerprint!="string"||e.signal||e.cancelToken||!e.precognitive?e:(w[e.fingerprint]=new AbortController,{...e,signal:w[e.fingerprint].signal}),N=e=>{var t;if(((t=e.headers)==null?void 0:t.precognition)!=="true")throw Error("Did not receive a Precognition response. Ensure you have the Precognition middleware in place for the route.")},le=e=>{var t;return!M(e)||typeof((t=e.response)==null?void 0:t.status)!="number"||z(e)},$=(e,t)=>({401:e.onUnauthorized,403:e.onForbidden,404:e.onNotFound,409:e.onConflict,422:e.onValidationError,423:e.onLocked})[t],ue=e=>{var t,s,a;return((t=e.headers)==null?void 0:t["Content-Type"])??((s=e.headers)==null?void 0:s["Content-type"])??((a=e.headers)==null?void 0:a["content-type"])??(I(e.data)?"multipart/form-data":"application/json")},I=e=>A(e)||typeof e=="object"&&e!==null&&Object.values(e).some(t=>I(t)),A=e=>typeof File<"u"&&e instanceof File||e instanceof Blob||typeof FileList<"u"&&e instanceof FileList&&e.length>0,he=e=>typeof e=="string"?e:e(),fe=e=>typeof e=="string"?e.toLowerCase():e(),ve=(e,t={})=>{const s={errorsChanged:[],touchedChanged:[],validatingChanged:[],validatedChanged:[]};let a=!1,l=!1;const E=r=>r!==l?(l=r,s.validatingChanged):[];let d=[];const T=r=>{const n=[...new Set(r)];return d.length!==n.length||!n.every(o=>d.includes(o))?(d=n,s.validatedChanged):[]},K=()=>d.filter(r=>typeof h[r]>"u");let c=[];const g=r=>{const n=[...new Set(r)];return c.length!==n.length||!n.every(o=>c.includes(o))?(c=n,s.touchedChanged):[]};let h={};const F=r=>{const n=ce(r);return ne(h,n)?[]:(h=n,s.errorsChanged)},Q=r=>{const n={...h};return delete n[O(r)],F(n)},W=()=>Object.keys(h).length>0;let D=1500;const X=r=>{D=r,V.cancel(),V=U()};let j=t,R=null,L=[],q=null;const U=()=>te(r=>{e({get:(n,o={},i={})=>v.get(n,m(o),b(i,r,o)),post:(n,o={},i={})=>v.post(n,m(o),b(i,r,o)),patch:(n,o={},i={})=>v.patch(n,m(o),b(i,r,o)),put:(n,o={},i={})=>v.put(n,m(o),b(i,r,o)),delete:(n,o={},i={})=>v.delete(n,m(o),b(i,r,o))}).catch(n=>{var o;return z(n)||M(n)&&((o=n.response)==null?void 0:o.status)===422?null:Promise.reject(n)})},D,{leading:!0,trailing:!0});let V=U();const b=(r,n,o={})=>{const i={...r,...n},f=Array.from(i.only??i.validate??c);return{...n,...ee(r,n),only:f,timeout:i.timeout??5e3,onValidationError:(u,y)=>([...T([...d,...f]),...F(B(H({...h},f),u.data.errors))].forEach(Z=>Z()),i.onValidationError?i.onValidationError(u,y):Promise.reject(y)),onSuccess:u=>(T([...d,...f]).forEach(y=>y()),i.onSuccess?i.onSuccess(u):u),onPrecognitionSuccess:u=>([...T([...d,...f]),...F(H({...h},f))].forEach(y=>y()),i.onPrecognitionSuccess?i.onPrecognitionSuccess(u):u),onBefore:()=>i.onBeforeValidation&&i.onBeforeValidation({data:o,touched:c},{data:j,touched:L})===!1||(i.onBefore||(()=>!0))()===!1?!1:(q=c,R=o,!0),onStart:()=>{E(!0).forEach(u=>u()),(i.onStart??(()=>null))()},onFinish:()=>{E(!1).forEach(u=>u()),L=q,j=R,q=R=null,(i.onFinish??(()=>null))()}}},Y=(r,n,o)=>{if(typeof r>"u"){const i=Array.from((o==null?void 0:o.only)??(o==null?void 0:o.validate)??[]);g([...c,...i]).forEach(f=>f()),V(o??{});return}if(A(n)&&!a){console.warn('Precognition file validation is not active. Call the "validateFiles" function on your form to enable it.');return}r=O(r),x(j,r)!==n&&(g([r,...c]).forEach(i=>i()),V(o??{}))},m=r=>a===!1?J(r):r,p={touched:()=>c,validate(r,n,o){return typeof r=="object"&&!("target"in r)&&(o=r,r=n=void 0),Y(r,n,o),p},touch(r){const n=Array.isArray(r)?r:[O(r)];return g([...c,...n]).forEach(o=>o()),p},validating:()=>l,valid:K,errors:()=>h,hasErrors:W,setErrors(r){return F(r).forEach(n=>n()),p},forgetError(r){return Q(r).forEach(n=>n()),p},reset(...r){if(r.length===0)g([]).forEach(n=>n());else{const n=[...c];r.forEach(o=>{n.includes(o)&&n.splice(n.indexOf(o),1),re(j,o,x(t,o))}),g(n).forEach(o=>o())}return p},setTimeout(r){return X(r),p},on(r,n){return s[r].push(n),p},validateFiles(){return a=!0,p}};return p},ye=e=>Object.keys(e).reduce((t,s)=>({...t,[s]:Array.isArray(e[s])?e[s][0]:e[s]}),{}),ce=e=>Object.keys(e).reduce((t,s)=>({...t,[s]:typeof e[s]=="string"?[e[s]]:e[s]}),{}),O=e=>typeof e!="string"?e.target.name:e,J=e=>{const t={...e};return Object.keys(t).forEach(s=>{const a=t[s];if(a!==null){if(A(a)){delete t[s];return}if(Array.isArray(a)){t[s]=a.filter(l=>!A(l));return}if(typeof a=="object"){t[s]=J(t[s]);return}}}),t};export{fe as a,O as b,ve as c,v as d,he as r,ye as t};
